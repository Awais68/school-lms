{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState}from'react';import{io}from'socket.io-client';import{useAuth}from'./AuthContext';import{jsx as _jsx}from\"react/jsx-runtime\";const SocketContext=/*#__PURE__*/createContext();export const SocketProvider=_ref=>{let{children}=_ref;const[socket,setSocket]=useState(null);const{token,isAuthenticated}=useAuth();useEffect(()=>{if(isAuthenticated&&token){// Connect to Socket.IO server\nconst newSocket=io(process.env.REACT_APP_SOCKET_URL||'http://localhost:5000',{auth:{token:token},transports:['websocket','polling']});setSocket(newSocket);// Listen for connection events\nnewSocket.on('connect',()=>{var _localStorage$getItem;console.log('Connected to server:',newSocket.id);// Send user identification\nnewSocket.emit('user_connected',(_localStorage$getItem=localStorage.getItem('user'))===null||_localStorage$getItem===void 0?void 0:_localStorage$getItem._id);});newSocket.on('disconnect',()=>{console.log('Disconnected from server');});// Listen for attendance updates\nnewSocket.on('attendance_updated',data=>{console.log('Attendance updated:',data);// Handle attendance update in the UI if needed\n});// Listen for notifications\nnewSocket.on('notification',data=>{console.log('Notification received:',data);// Show notification to user\nif(window.Notification&&Notification.permission==='granted'){new Notification(data.title||'Notification',{body:data.message||'You have a new notification'});}});// Clean up on unmount\nreturn()=>{newSocket.close();};}},[isAuthenticated,token]);return/*#__PURE__*/_jsx(SocketContext.Provider,{value:socket,children:children});};export const useSocket=()=>{const context=useContext(SocketContext);if(!context){throw new Error('useSocket must be used within a SocketProvider');}return context;};export default SocketContext;","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","io","useAuth","jsx","_jsx","SocketContext","SocketProvider","_ref","children","socket","setSocket","token","isAuthenticated","newSocket","process","env","REACT_APP_SOCKET_URL","auth","transports","on","_localStorage$getItem","console","log","id","emit","localStorage","getItem","_id","data","window","Notification","permission","title","body","message","close","Provider","value","useSocket","context","Error"],"sources":["/media/awais/New Volume/no-code/lms/client/src/context/SocketContext.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\nimport { io } from 'socket.io-client';\nimport { useAuth } from './AuthContext';\n\nconst SocketContext = createContext();\n\nexport const SocketProvider = ({ children }) => {\n  const [socket, setSocket] = useState(null);\n  const { token, isAuthenticated } = useAuth();\n\n  useEffect(() => {\n    if (isAuthenticated && token) {\n      // Connect to Socket.IO server\n      const newSocket = io(process.env.REACT_APP_SOCKET_URL || 'http://localhost:5000', {\n        auth: {\n          token: token\n        },\n        transports: ['websocket', 'polling']\n      });\n\n      setSocket(newSocket);\n\n      // Listen for connection events\n      newSocket.on('connect', () => {\n        console.log('Connected to server:', newSocket.id);\n        \n        // Send user identification\n        newSocket.emit('user_connected', localStorage.getItem('user')?._id);\n      });\n\n      newSocket.on('disconnect', () => {\n        console.log('Disconnected from server');\n      });\n\n      // Listen for attendance updates\n      newSocket.on('attendance_updated', (data) => {\n        console.log('Attendance updated:', data);\n        // Handle attendance update in the UI if needed\n      });\n\n      // Listen for notifications\n      newSocket.on('notification', (data) => {\n        console.log('Notification received:', data);\n        // Show notification to user\n        if (window.Notification && Notification.permission === 'granted') {\n          new Notification(data.title || 'Notification', {\n            body: data.message || 'You have a new notification'\n          });\n        }\n      });\n\n      // Clean up on unmount\n      return () => {\n        newSocket.close();\n      };\n    }\n  }, [isAuthenticated, token]);\n\n  return (\n    <SocketContext.Provider value={socket}>\n      {children}\n    </SocketContext.Provider>\n  );\n};\n\nexport const useSocket = () => {\n  const context = useContext(SocketContext);\n  if (!context) {\n    throw new Error('useSocket must be used within a SocketProvider');\n  }\n  return context;\n};\n\nexport default SocketContext;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,UAAU,CAAEC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAC7E,OAASC,EAAE,KAAQ,kBAAkB,CACrC,OAASC,OAAO,KAAQ,eAAe,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAExC,KAAM,CAAAC,aAAa,cAAGR,aAAa,CAAC,CAAC,CAErC,MAAO,MAAM,CAAAS,cAAc,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CACzC,KAAM,CAACE,MAAM,CAAEC,SAAS,CAAC,CAAGV,QAAQ,CAAC,IAAI,CAAC,CAC1C,KAAM,CAAEW,KAAK,CAAEC,eAAgB,CAAC,CAAGV,OAAO,CAAC,CAAC,CAE5CH,SAAS,CAAC,IAAM,CACd,GAAIa,eAAe,EAAID,KAAK,CAAE,CAC5B;AACA,KAAM,CAAAE,SAAS,CAAGZ,EAAE,CAACa,OAAO,CAACC,GAAG,CAACC,oBAAoB,EAAI,uBAAuB,CAAE,CAChFC,IAAI,CAAE,CACJN,KAAK,CAAEA,KACT,CAAC,CACDO,UAAU,CAAE,CAAC,WAAW,CAAE,SAAS,CACrC,CAAC,CAAC,CAEFR,SAAS,CAACG,SAAS,CAAC,CAEpB;AACAA,SAAS,CAACM,EAAE,CAAC,SAAS,CAAE,IAAM,KAAAC,qBAAA,CAC5BC,OAAO,CAACC,GAAG,CAAC,sBAAsB,CAAET,SAAS,CAACU,EAAE,CAAC,CAEjD;AACAV,SAAS,CAACW,IAAI,CAAC,gBAAgB,EAAAJ,qBAAA,CAAEK,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,UAAAN,qBAAA,iBAA5BA,qBAAA,CAA8BO,GAAG,CAAC,CACrE,CAAC,CAAC,CAEFd,SAAS,CAACM,EAAE,CAAC,YAAY,CAAE,IAAM,CAC/BE,OAAO,CAACC,GAAG,CAAC,0BAA0B,CAAC,CACzC,CAAC,CAAC,CAEF;AACAT,SAAS,CAACM,EAAE,CAAC,oBAAoB,CAAGS,IAAI,EAAK,CAC3CP,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAEM,IAAI,CAAC,CACxC;AACF,CAAC,CAAC,CAEF;AACAf,SAAS,CAACM,EAAE,CAAC,cAAc,CAAGS,IAAI,EAAK,CACrCP,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAEM,IAAI,CAAC,CAC3C;AACA,GAAIC,MAAM,CAACC,YAAY,EAAIA,YAAY,CAACC,UAAU,GAAK,SAAS,CAAE,CAChE,GAAI,CAAAD,YAAY,CAACF,IAAI,CAACI,KAAK,EAAI,cAAc,CAAE,CAC7CC,IAAI,CAAEL,IAAI,CAACM,OAAO,EAAI,6BACxB,CAAC,CAAC,CACJ,CACF,CAAC,CAAC,CAEF;AACA,MAAO,IAAM,CACXrB,SAAS,CAACsB,KAAK,CAAC,CAAC,CACnB,CAAC,CACH,CACF,CAAC,CAAE,CAACvB,eAAe,CAAED,KAAK,CAAC,CAAC,CAE5B,mBACEP,IAAA,CAACC,aAAa,CAAC+B,QAAQ,EAACC,KAAK,CAAE5B,MAAO,CAAAD,QAAA,CACnCA,QAAQ,CACa,CAAC,CAE7B,CAAC,CAED,MAAO,MAAM,CAAA8B,SAAS,CAAGA,CAAA,GAAM,CAC7B,KAAM,CAAAC,OAAO,CAAGzC,UAAU,CAACO,aAAa,CAAC,CACzC,GAAI,CAACkC,OAAO,CAAE,CACZ,KAAM,IAAI,CAAAC,KAAK,CAAC,gDAAgD,CAAC,CACnE,CACA,MAAO,CAAAD,OAAO,CAChB,CAAC,CAED,cAAe,CAAAlC,aAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}